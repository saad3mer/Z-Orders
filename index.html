<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Operation Number</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<style>
body { font-family: Arial; direction: rtl; background: #eef2f7; padding: 20px; transition:.3s; color:#111827; }
body.dark { background:#1f2937; color:#f9fafb; }

.container { max-width: 1200px; margin: auto; }
.box { background: #fff; padding: 30px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 6px 16px rgba(0,0,0,0.1); transition:.3s; }
body.dark .box { background:#111827; box-shadow:0 6px 16px rgba(0,0,0,0.3); }

h3 { text-align: center; margin-bottom: 20px; }

input {
    width: 100%;
    padding: 12px;
    margin-top:5px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 14px;
    transition:.3s;
}
body.dark input { background:#1f2937; border:1px solid #374151; color:#f9fafb; }

button {
    padding: 12px 20px;
    cursor: pointer;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    transition: 0.2s;
}
button:active { transform: scale(0.96); }

.generate-btn { width: 50%; background:#4CAF50; color:#fff; }
.copy-btn { width: 50%; background:#2196F3; color:#fff; }
.search-container { display:flex; gap:10px; margin-top:15px; }
.search-container button { background:#FF9800; color:#fff; }

.table-wrapper { max-height: 600px; overflow-y:auto; margin-top:20px; }
table { width:100%; border-collapse:collapse; }
th,td { border:1px solid #ccc; padding:12px; text-align:center; transition:.3s; }
th { background:#4CAF50; color:#fff; }
tr:nth-child(even){ background:#f2f2f2; }
body.dark th { background:#2563eb; color:#fff; }
body.dark td { border-color:#374151; }
body.dark tr:nth-child(even){ background:#1f2937; }

.last-order { background:#FFF59D !important; font-weight:bold; }

.order-popup {
    position:fixed;
    top:20px;
    left:50%;
    transform:translateX(-50%);
    background:#4CAF50;
    color:#fff;
    padding:15px 25px;
    border-radius:10px;
    font-size:18px;
    opacity:0;
    transition:0.4s;
    z-index:1000;
}
.order-popup.show { opacity:1; }

.file-buttons { display:flex; gap:10px; margin-top:15px; }
.file-buttons button { background:#FF5722; color:#fff; font-size:14px; padding:8px 14px; }
</style>
</head>

<body>

<div class="container">
<div class="box">

<h3>ğŸ”¢ Operation Number</h3>
<input id="amount" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº">

<div style="display:flex; gap:10px; margin-top:10px;">
    <button class="generate-btn" onclick="generateOrder()">
        <i class="fa fa-plus"></i> ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯
    </button>
    <button class="copy-btn" onclick="copyOrder()">
        <i class="fa fa-copy"></i> Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±
    </button>
</div>

<h3 style="margin-top:30px;">ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„ÙŠØ©</h3>
<div class="search-container">
    <input id="searchInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±">
    <button onclick="searchOrder()"><i class="fa fa-search"></i> Ø¨Ø­Ø«</button>
</div>

<h3 style="margin-top:30px;">ğŸ“‹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>

<div class="table-wrapper">
<table id="ordersTable">
<thead>
<tr>
    <th>Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±</th>
    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
    <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<div class="file-buttons">
    <input type="file" id="importFile" accept=".xlsx">
    <button onclick="importOrders()"><i class="fa fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel</button>
    <button onclick="exportToExcel()"><i class="fa fa-file-export"></i> ØªØµØ¯ÙŠØ± Excel</button>
</div>

</div>
</div>

<div id="orderPopup" class="order-popup"></div>

<script>
let lastOrderNumber = "";

function getToday(){
    const d = new Date();
    return d.getFullYear().toString().slice(2) +
           String(d.getMonth()+1).padStart(2,'0') +
           String(d.getDate()).padStart(2,'0');
}

function generateOrder(){
    const amount = document.getElementById("amount").value.trim();
    if(!amount || isNaN(amount)){ alert("Ø§Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­"); return; }

    const today = getToday();
    const counterKey = "counter_" + today;
    let count = localStorage.getItem(counterKey);
    count = count ? parseInt(count) + 1 : 1;
    localStorage.setItem(counterKey, count);

    const now = new Date();
    const orderNumber = today +
        String(now.getHours()).padStart(2,'0') +
        String(now.getMinutes()).padStart(2,'0') +
        count;

    lastOrderNumber = orderNumber;

    localStorage.setItem(orderNumber, JSON.stringify({
        amount: amount,
        date: new Date().toLocaleString()
    }));

    document.getElementById("amount").value = "";
    showPopup(orderNumber);
    updateOrdersTable();

    navigator.clipboard.writeText(orderNumber);
}

function showPopup(num){
    const p = document.getElementById("orderPopup");
    p.textContent = "Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±: " + num;
    p.classList.add("show");
    setTimeout(()=>p.classList.remove("show"),1500);
}

function copyOrder(){
    if(!lastOrderNumber) return;
    navigator.clipboard.writeText(lastOrderNumber);
}

function updateOrdersTable(){
    const tbody = document.querySelector("#ordersTable tbody");
    tbody.innerHTML = "";
    let orders = [];

    for(let i=0;i<localStorage.length;i++){
        const key = localStorage.key(i);
        if(!isNaN(key)){
            const data = JSON.parse(localStorage.getItem(key));
            orders.push({order:key, amount:data.amount, date:data.date});
        }
    }

    orders.sort((a,b)=>b.order.localeCompare(a.order));

    orders.forEach(o=>{
        const tr = document.createElement("tr");
        if(o.order === lastOrderNumber) tr.classList.add("last-order");
        tr.innerHTML = `<td>${o.order}</td><td>${o.amount}</td><td>${o.date}</td>`;
        tbody.appendChild(tr);
    });
}

function searchOrder(){
    const val = document.getElementById("searchInput").value.trim();
    if(!val){ updateOrdersTable(); return; }

    const tbody = document.querySelector("#ordersTable tbody");
    tbody.innerHTML = "";

    if(!isNaN(val) && localStorage.getItem(val)){
        const d = JSON.parse(localStorage.getItem(val));
        tbody.innerHTML = `<tr><td>${val}</td><td>${d.amount}</td><td>${d.date}</td></tr>`;
    } else {
        tbody.innerHTML = `<tr><td colspan="3">âŒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</td></tr>`;
    }
}

function exportToExcel(){
    let arr = [];
    for(let i=0;i<localStorage.length;i++){
        const key = localStorage.key(i);
        if(!isNaN(key)){
            const d = JSON.parse(localStorage.getItem(key));
            arr.push({"Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±":key,"Ø§Ù„Ù…Ø¨Ù„Øº":d.amount,"Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª":d.date});
        }
    }
    const ws = XLSX.utils.json_to_sheet(arr);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,"Orders");
    XLSX.writeFile(wb,"Orders.xlsx");
}

function importOrders(){
    const file = document.getElementById("importFile").files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = e=>{
        const data = new Uint8Array(e.target.result);
        const wb = XLSX.read(data,{type:"array"});
        const rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
        rows.forEach(r=>{
            if(r["Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±"]){
                localStorage.setItem(r["Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±"], JSON.stringify({
                    amount:r["Ø§Ù„Ù…Ø¨Ù„Øº"],
                    date:r["Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª"]
                }));
            }
        });
        updateOrdersTable();
        alert("ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ âœ…");
    };
    reader.readAsArrayBuffer(file);
}

// ØªÙØ¹ÙŠÙ„ Ø²Ø± Enter Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ù‚Ù… ÙˆÙ†Ø³Ø®Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠ
document.getElementById("amount").addEventListener("keydown", function(e){
    if(e.key === "Enter"){
        generateOrder();
    }
});

updateOrdersTable();

// =========================
// Dark Mode Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Tools Hub
// =========================
window.addEventListener("message", (event) => {
    if(event.data.dark !== undefined){
        if(event.data.dark){
            document.body.classList.add("dark");
        } else {
            document.body.classList.remove("dark");
        }
    }
});
</script>

</body>
</html>
